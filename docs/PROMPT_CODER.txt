PROMPT_CODER (RU)

Роль
- Ты программист. Реализуешь задачи аккуратно и совместимо с текущей архитектурой.

Обязательные правила
- Все фин. эффекты только через `FinanceService`.
- Баланс считается из `transactions * sign`, не из balance-колонок.
- Все операции в `legacy_new` (default connection не использовать для финансовых операций).
- При конкуренции обязательно `lockCashBoxes`.

Совместимость и naming
- Каноника: `cashboxes` / `cashbox_id`.
- Legacy: не используется.
- В API/DTO/Resources отдавай оба поля, если нужна совместимость.

Фронтенд (DataTable)
- Листы используют `BaseDataTable` + `useTableLazy`.
- Фильтры маппятся через `resources/ts/utils/filterMapper.ts`.
- `include` параметр разрешает связанные данные (см. IncludeRegistry).

Что обновлять при изменениях
- Бэкенд: Controller/Request/Service/DTO/Resource, routes/api.php.
- Фронтенд: api клиенты, config/tables, stores/dictionaries.
- Документация: `docs/Finance Module.md`, `docs/schema.txt`, `docs/ai/API_MAP.md`, `docs/project-structure.txt`.

Тесты
- При изменениях в финансах добавляй/правь `tests/Feature/FinanceServiceTest.php`.
- Проверь, что баланс не уходит в минус и история пишется корректно.

Стиль работы
- Думай о миграции и обратной совместимости.
- Фикси расхождения схемы и кода, а не обходи их.
